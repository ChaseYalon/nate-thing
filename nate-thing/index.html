<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Get Pixel Color</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="center">
      <canvas id="canvas"></canvas>
    </div>
    <div class="container">
      <div class="r">
        <p id="r"></p>
        <hr />
        <p class="center">R</p>
      </div>
      <div class="g">
        <p id="g"></p>
        <hr />
        <p class="center">G</p>
      </div>
      <div class="b">
        <p id="b"></p>
        <hr />
        <p class="center">B</p>
      </div>
      <div class="a">
        <p id="a"></p>
        <hr />
        <p class="center">A</p>
      </div>
    </div>

    <script>
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");
      const r = document.getElementById("r");
      const g = document.getElementById("g");
      const b = document.getElementById("b");
      const a = document.getElementById("a");

      // Image to be drawn on the canvas
      const image = new Image();
      image.src = "imgs/dog.png"; // Provide the path to your image here

      image.onload = function () {
        // Set the canvas size to match the image
        canvas.width = image.width;
        canvas.height = image.height;

        // Draw the image to the canvas
        ctx.drawImage(image, 0, 0);
      };

      // Function to get pixel color under the mouse
      function getPixelColor(event) {
        const x = event.offsetX;
        const y = event.offsetY;

        // Check if the mouse coordinates are within bounds of the image
        if (x >= 0 && x < canvas.width && y >= 0 && y < canvas.height) {
          // Get the pixel data from the canvas at (x, y)
          const pixel = ctx.getImageData(x, y, 1, 1).data;
          console.log(pixel);
          // Check the pixel data

          // Convert pixel data to RGB format
          const rp = pixel[0];
          const gp = pixel[1];
          const bp = pixel[2];
          const ap = pixel[3] / 255; // Alpha channel is between 0 and 1
          r.innerHTML = rp;
          g.innerHTML = gp;
          b.innerHTML = bp;
          a.innerHTML = ap;
        } else {
          console.log("Mouse is outside canvas bounds.");
        }
      }
      function rgbaToHsv(r, g, b) {
        r /= 255;
        g /= 255;
        b /= 255;

        const max = Math.max(r, g, b);
        const min = Math.min(r, g, b);
        let h,
          s,
          v = max;

        const d = max - min;
        s = max === 0 ? 0 : d / max;

        if (max === min) {
          h = 0; // achromatic
        } else {
          switch (max) {
            case r:
              h = (g - b) / d + (g < b ? 6 : 0);
              break;
            case g:
              h = (b - r) / d + 2;
              break;
            case b:
              h = (r - g) / d + 4;
              break;
          }
          h /= 6;
        }

        return [h, s, v];
      }

      function processImageData(ctx, x, y, width, height) {
        const imageData = ctx.getImageData(x, y, width, height);
        const data = imageData.data;

        for (let i = 0; i < data.length; i += 4) {
          const r = data[i];
          const g = data[i + 1];
          const b = data[i + 2];
          //const a = data[i + 3]; // Alpha is not used in HSV conversion

          const hsv = rgbaToHsv(r, g, b);
          // hsv is now an array [hue, saturation, value]
          // You can now work with the HSV values, e.g., modify them or store them
          data[i] = hsv[0] * 255; //Use hue for R
          data[i + 1] = hsv[1] * 255; //Use saturation for G
          data[i + 2] = hsv[2] * 255; //Use value for B
        }
        ctx.putImageData(imageData, x, y);
      }

      canvas.addEventListener("mousemove", getPixelColor);
    </script>
  </body>
</html>
